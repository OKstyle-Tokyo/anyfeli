<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="stylesheet" href="main.css">
    
    <title>AnyFeliProto</title>
  </head>

  <body>
    <h1>AnyFeliProto</h1>
    <br />
    <button onclick="onStartButtonClick()">接続</button>
    <br />
    <button onclick="onResetButtonClick()">リセット</button>
    <br />

    <h3>Live Output</h3>
    <div id="output" class="output">
    <div id="content"></div>
    <div id="status"></div>
    <pre id="log"></pre>
    </div>
    <div id="device_name">xxxx</div>
    <div id="data_text">xxxx</div>

    <script>
      const UUID_S = "bfc48e47-d301-45e7-9438-778662410516"; // Service
      const UUID_C = "3d99c3fc-9ce1-442f-8edd-6a5ead8f4b1d"; // Characteristic

      let bluetoothDevice;
      let characteristic;

      async function onStartButtonClick() {
        try {
          console.log("Requesting Bluetooth Device...");
          const device = await navigator.bluetooth.requestDevice({
            filters: [{ namePrefix: "Blank" }],
            optionalServices: [UUID_S],
          });
          
          console.log("Connecting to GATT Server...");
          const server = await device.gatt.connect();
          console.log("Getting Service...");
          const service = await server.getPrimaryService(UUID_S);
          console.log("Getting Characteristic...");
          characteristic = await service.getCharacteristic(UUID_C);
          console.log("characteristic OK!!")
          alert("BLE接続が完了しました。");
          
        } catch (error) {
          console.log("Argh! " + error);
        }
      }
      
    //BLE切断処理
    function onResetButtonClick() {
      if (!bluetoothDevice || !bluetoothDevice.gatt.connected) return ;
      bluetoothDevice.gatt.disconnect();
      alert("BLE接続を切断しました。")
    }
    </script>
  </body>
</html>
